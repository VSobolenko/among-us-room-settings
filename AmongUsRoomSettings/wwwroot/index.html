<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Настройки NormalGameOptionsV10</title>
  <link rel="stylesheet" href="stylesGeneral.css">
  <link rel="stylesheet" href="stylesInstructions.css">
  <script src="PreInstalledOptions/clown.js"></script>
  <script src="PreInstalledOptions/defaultOptions.js"></script>
  <script src="PreInstalledOptions/gexetr.js"></script>
  <script src="PreInstalledOptions/laf1.js"></script>
  <script src="PreInstalledOptions/shpeksi.js"></script>
  <script src="AccessScripts.js"></script>
  <script src="SetOptions.js"></script>
  <script src="RoleOptionsBuilder.js"></script>
  <script src="GameOptionsBuilder.js"></script>
</head>
<body>
<header>Конфигуратор: NormalGameOptionsV09</header>
<div class="container">

  <div id="accessBlock" style="margin-bottom: 20px;">
    <label for="keyInput"></label><input id="keyInput" placeholder="Введите ключ доступа"
                                         style="padding:5px; font-size:14px;"/>
    <button onclick="checkKey()" style="padding:5px 10px; font-size:14px;">Подтвердить ключ</button>
  </div>

  <div id="mainUI" style="display: none;">

    <div class="instructions">
      <h2>📖 Инструкция по вставке сгенерированной строки</h2>
      <p>Чтобы применить настройки в <strong>Among Us</strong>, повторяйте шаги, как показано в видео, но вставляйте <em>свою</em> строку:</p>

      <div class="video-block">
        🎥 <a href="https://www.youtube.com/watch?v=iz3eBfY5CqQ" target="_blank">Смотреть видео-инструкцию</a>
      </div>

      <ol>
        <li>
          <span class="platform">📱 Android:</span> найдите файл настроек:
          <code>\Phone\Android\data\com.innersloth.spacemafia\files\</code>
        </li>
        <li>
          <span class="platform">💻 ПК:</span> путь к файлу настроек:
          <code>%userprofile%/appdata/locallow/innersloth/Among Us/</code>
        </li>
        <li>
          Откройте файл <code>settings.amogus</code> и найдите поле <strong>normalHostOptions</strong>
          <div class="note">Обычно это около <strong>35-й строки</strong>.</div>
          <div class="note warning">Удалите старую строку, оставив кавычки. Вставьте туда сгенерированную строку.</div>
        </li>
        <li>
          💾 Сохраните файл и закройте его.
          <div class="note"><strong>Важно:</strong> игра должна быть полностью закрыта во время изменения!</div>
        </li>
        <li>
          <span class="platform">📱 Android:</span> удобно использовать такие приложения:
          <ul>
            <li><a href="https://play.google.com/store/apps/details?id=com.marc.files" target="_blank">Marc File Manager</a> — для поиска файлов</li>
            <li><a href="https://play.google.com/store/apps/details?id=com.rhmsoft.edit" target="_blank">QuickEdit</a> — для редактирования</li>
          </ul>
        </li>
        <li>
          <span class="platform">🍏 iPhone:</span> доступ к файлу, к сожалению, недоступен.
        </li>
      </ol>
    </div>

    <div class="options-card">
      <h3>Выбери вариант предустановленных настроек:</h3>
      <div class="options-grid">
        <button class="options-pre-installed" id="btn-opt-default">По умолчанию (Default)</button>
        <button class="options-pre-installed" id="btn-opt-gexetr">Gexetr</button>
        <button class="options-pre-installed" id="btn-opt-shpeksi">Пупсик & Шпекси</button>
        <button class="options-pre-installed" id="btn-opt-lafi">LaF1</button>
        <button class="options-pre-installed" id="btn-opt-clown">Для игры в клона</button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="main">Основные настройки</div>
      <div class="tab" data-tab="roles">Роли</div>
    </div>

    <!-- ОСНОВНЫЕ -->
    <div id="panel-main" class="panel active">
      <div class="grid-2">

        <label>Версия (byte)
          <input type="number" id="Version" data-type="byte" value="10" min="10" max="10">
          <span class="hint">Тут лучше не трогать</span>
        </label>

        <label>Неизвестный байт (byte)
          <input type="number" id="UNKNOWN_BYTE" data-type="byte" value="1" min="1" max="1">
          <span class="hint">Зачем он нужен</span>
        </label>

        <label>Максимум игроков (byte)
          <input type="number" id="MaxPlayers" data-type="byte" value="15" min="4" max="15">
          <span class="hint">Диапазон: 4–15</span>
        </label>

        <label>ID карты (byte)
          <input type="number" id="MapId" data-type="byte" value="0" min="0" max="5">
          <span class="hint">0–skeld, 1-mira hq, 2-polus..</span>
        </label>

        <label>Язык
          <div class="row">
            <select id="KeywordsSelect">
              <option value="Russian" selected>Russian</option>
              <option value="English">English</option>
            </select>
            <input type="text" id="KeywordsCustom" placeholder="Другое имя enum (опц.)">
          </div>
        </label>

        <label>Дистанция убийства
          <div class="row">
            <select id="KillDistanceSelect">
              <option value="Short">Short</option>
              <option value="Medium" selected>Medium</option>
              <option value="Long">Long</option>
            </select>
          </div>
        </label>

        <label>Обновление шкалы заданий
          <div class="row">
            <select id="TaskBarModeSelect">
              <option value="Always" selected>Always</option>
              <option value="MeetingOnly">MeetingOnly</option>
              <option value="Never">Never</option>
            </select>
          </div>
        </label>

        <label>Спец. режим (SpecialGameModes — enum)
          <div class="row">
            <select id="SpecialModeSelect">
              <option value="None">None</option>
              <option value="AprilFools" selected>AprilFools</option>
            </select>
            <input type="text" id="SpecialModeCustom" placeholder="Другое имя enum (опц.)">
          </div>
          <span class="hint">Лучше оставить как есть</span>
        </label>

        <label>Пресет правил (RulesPresets — enum)
          <div class="row">
            <select id="RulesPresetSelect">
              <option value="Standard" selected>Standard</option>
              <option value="Meetings">StandardRoles</option>
              <option value="Meetings">Flashlight</option>
            </select>
            <input type="text" id="RulesPresetCustom" placeholder="Другое имя enum (опц.)">
          </div>
          <span class="hint">Лучше оставить как есть</span>
        </label>

        <label>Скорость игрока (float)
          <input type="number" id="PlayerSpeedMod" data-type="float" value="1.0" step="0.1" min="0.0000001" max="3">
          <span class="hint">0.0000001 - 3, после запятой желательно не более 6 цифр</span>
        </label>

        <label>Обзор экипажа (float)
          <input type="number" id="CrewLightMod" data-type="float" value="1.0" step="0.1">
        </label>

        <label>Количество предателей (byte)
          <input type="number" id="NumImpostors" data-type="byte" value="3" min="1" max="3">
          <span class="hint">1-3</span>
        </label>

        <label>Обзор предателя (float)
          <input type="number" id="ImpostorLightMod" data-type="float" value="1.5" step="0.1">
        </label>

        <label>КД убийства, сек (float)
          <input type="number" id="KillCooldown" data-type="float" value="45" step="0.1">
        </label>

        <label>Общие(обычные) задачи (byte)
          <input type="number" id="NumCommonTasks" data-type="byte" value="1">
        </label>

        <label>Время обсуждения, сек (int)
          <input type="number" id="DiscussionTime" data-type="int" value="15">
        </label>

        <label>Короткие задачи (byte)
          <input type="number" id="NumShortTasks" data-type="byte" value="2">
        </label>

        <label>Время голосования, сек (int)
          <input type="number" id="VotingTime" data-type="int" value="120">
        </label>

        <label>Длинные задачи (byte)
          <input type="number" id="NumLongTasks" data-type="byte" value="1">
        </label>

        <label class="row"><input type="checkbox" id="VisualTasks" checked>Видимые задания</label>

        <label>Срочных собраний (int)
          <input type="number" id="NumEmergencyMeetings" data-type="int" value="1">
        </label>

        <label class="row"><input type="checkbox" id="ConfirmImpostor" checked>Роль выброшенного</label>

        <label>Перезарядка между собраниями, сек (byte)
          <input type="number" id="EmergencyCooldown" data-type="byte" value="15">
        </label>

        <label class="row"><input type="checkbox" id="AnonymousVotes">Тайное голосование</label>

        <label>Тэг (byte)
          <input type="number" id="Tag" data-type="byte" value="0" min="0" max="3">
          <span class="hint">0-нет, 1-новичёк, 2-любитель, 3-эксперт</span>
        </label>

        <label class="row"><input type="checkbox" id="IsDefaults">
          Считать настройку дефолтной (IsDefaults)
          <span class="hint">Не учитывается</span>
        </label>
      </div>
    </div>

    <!-- РОЛИ -->
    <div id="panel-roles" class="panel">

      <!-- Scientist -->
      <div class="role-card">
        <h3 class="role-title">Учёный (Scientist)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Scientist_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Scientist_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка панели проверки пульса (byte)<input type="number" id="ScientistCooldown" data-type="byte"
                                                                 value="15"></label>
          <label>Время работы батареи (byte)<input type="number" id="ScientistBatteryCharge" data-type="byte" value="5"></label>
        </div>
      </div>

      <!-- Guardian Angel -->
      <div class="role-card">
        <h3 class="role-title">Ангел-хранитель (GuardianAngel)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Guardian_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Guardian_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка щита (byte)<input type="number" id="GuardianAngelCooldown" data-type="byte"
                                               value="60"></label>
          <label>Длительность защиты, сек (byte)<input type="number" id="ProtectionDurationSeconds" data-type="byte"
                                                       value="10"></label>
          <label class="row"><input type="checkbox" id="ImpostorsCanSeeProtect">Предатели видят защиту</label>
        </div>
      </div>

      <!-- Engineer -->
      <div class="role-card">
        <h3 class="role-title">Инженер (Engineer)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Engineer_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Engineer_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка люка (byte)<input type="number" id="EngineerCooldown" data-type="byte" value="30"></label>
          <label>Время пребывания в люке (byte)<input type="number" id="EngineerInVentMaxTime" data-type="byte"
                                                      value="15"></label>
        </div>
      </div>

      <!-- Noisemaker -->
      <div class="role-card">
        <h3 class="role-title">Паникер (Noisemaker)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Noisemaker_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Noisemaker_Chance" data-type="byte" value="100"></label>
          <label>Длительность сигнала (byte)<input type="number" id="NoisemakerAlertDuration" data-type="byte"
                                                   value="10"></label>
          <label class="row"><input type="checkbox" id="NoisemakerImpostorAlert" checked>Оповещение предателю</label>
        </div>
      </div>

      <!-- Tracker -->
      <div class="role-card">
        <h3 class="role-title">Следопыт (Tracker)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Tracker_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Tracker_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка слежки (byte)<input type="number" id="TrackerCooldown" data-type="byte" value="15"></label>
          <label>Длительность слежки (byte)<input type="number" id="TrackerDuration" data-type="byte"
                                                  value="30"></label>
          <label>Задержка слежки (byte)<input type="number" id="TrackerDelay" data-type="byte" value="1"></label>
        </div>
      </div>

      <!-- Detective -->
      <div class="role-card">
        <h3 class="role-title">Детектив (Detective)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Detective_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Detective_Chance" data-type="byte" value="100"></label>
          <label>Подозреваемые по делу (byte)<input type="number" id="DetectiveSuspectLimit" data-type="byte" value="3"></label>
        </div>
      </div>

      <!-- Shapeshifter -->
      <div class="role-card">
        <h3 class="role-title">Оборотень (Shapeshifter)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Shapeshifter_MaxCount" data-type="byte"
                                         value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Shapeshifter_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка маскировки (byte)<input type="number" id="ShapeshifterCooldown" data-type="byte"
                                                     value="10"></label>
          <label>Длительность маскировки (byte)<input type="number" id="ShapeshifterDuration" data-type="byte"
                                                      value="30"></label>
          <label class="row"><input type="checkbox" id="ShapeshifterLeaveSkin">Оставлять скин при превращении</label>
        </div>
      </div>

      <!-- Phantom -->
      <div class="role-card">
        <h3 class="role-title">Фантом (Phantom)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Phantom_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Phantom_Chance" data-type="byte" value="100"></label>
          <label>Перезарядка невидимости (byte)<input type="number" id="PhantomCooldown" data-type="byte"
                                                      value="15"></label>
          <label>Длительность невидимости (byte)<input type="number" id="PhantomDuration" data-type="byte"
                                                       value="30"></label>
        </div>
      </div>

      <!-- Viper -->
      <div class="role-card">
        <h3 class="role-title">Гадюка (Viper)</h3>
        <div class="grid-2">
          <label>Количество (byte)<input type="number" id="Role_Viper_MaxCount" data-type="byte" value="1"></label>
          <label>Шанс (byte)<input type="number" id="Role_Viper_Chance" data-type="byte" value="100"></label>
          <label>Время растворения (byte)<input type="number" id="ViperDissolveTime" data-type="byte" value="15"><span
              class="hint">Ставить от 1 и выше</span>
          </label>
        </div>
      </div>
    </div>

    <div class="actions">
      <button class="btn" type="button" id="btn-generate">Сформировать строку</button>
      <button class="btn btn-outline" type="button" id="btn-copy">Копировать</button>
    </div>
    <div id="result"></div>

  </div>
</div>

<script>
  // ---- tabs ----
  document.querySelectorAll('.tab').forEach(t => {
    t.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      document.getElementById('panel-' + t.dataset.tab).classList.add('active');
    });
  });

  const INT_MIN = -2147483648, INT_MAX = 2147483647;

  function clampByType(el) {
    const type = el.dataset.type;
    if (!type) return;
    let v = el.value === '' ? NaN : Number(el.value);
    if (Number.isNaN(v)) return;
    if (type === 'byte') {
      if (v < 0) v = 0;
      if (v > 255) v = 255;
      el.value = Math.trunc(v);
    } else if (type === 'int') {
      if (v < INT_MIN) v = INT_MIN;
      if (v > INT_MAX) v = INT_MAX;
      el.value = Math.trunc(v);
    } else if (type === 'float') {
      // float ignored
    }
  }

  document.querySelectorAll('input[type="number"]').forEach(el => {
    el.addEventListener('input', () => clampByType(el));
    el.addEventListener('change', () => clampByType(el));
  });

  function enumValue(selectId, customId) {
    if (customId) {
      const customEl = document.getElementById(customId);
      if (customEl) {
        const custom = customEl.value.trim();
        if (custom) return custom;
      }
    }
    return document.getElementById(selectId).value;
  }

  function num(id) {
    return Number(document.getElementById(id).value || 0);
  }

  function numf(id) {
    return Number(document.getElementById(id).value || 0);
  }

  function checked(id) {
    return !!document.getElementById(id).checked;
  }

  async function sendToServer(payload) {
    console.log(JSON.stringify(payload));
    const resp = await fetch('/encode', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });
    try {
      return await resp.json();
    } catch {
      return await resp.text();
    }
  }

  async function generate() {
    const data = collectMain();
    const encoded = await sendToServer(data);
    document.getElementById('result').textContent = encoded;
    return encoded;
  }

  document.getElementById('btn-generate').addEventListener('click', generate);
  document.getElementById('btn-copy').addEventListener('click', async () => {
    const txt = document.getElementById('result').textContent.trim();
    if (!txt) return;
    try {
      await navigator.clipboard.writeText(txt);
    } catch {
      // no-op
    }
  });

  document.getElementById("btn-opt-default").addEventListener("click", () => setOptions(presets.defaultOptions));
  document.getElementById("btn-opt-gexetr").addEventListener("click", () => setOptions(presets.gexetr));
  document.getElementById("btn-opt-shpeksi").addEventListener("click", () => setOptions(presets.shpeksi));
  document.getElementById("btn-opt-lafi").addEventListener("click", () => setOptions(presets.laf1));
  document.getElementById("btn-opt-clown").addEventListener("click", () => setOptions(presets.clown));
</script>
</body>
</html>
